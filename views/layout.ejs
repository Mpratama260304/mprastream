<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - StreamFlow</title>
  <link rel="icon" href="/images/logo.svg" type="image/svg+xml">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.30.0/fonts/tabler-icons.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.30.0/tabler-icons.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind CSS with unified config -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/js/tailwind-config.js"></script>
  
  <!-- Custom Theme Styles -->
  <link rel="stylesheet" href="/css/theme.css">
  <link rel="stylesheet" href="/css/styles.css">
  
  <!-- Deferred Scripts -->
  <script src="/js/stream-modal.js" defer></script>
  <script src="/js/layout-ui.js" defer></script>
  
  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
          .then(function(registration) {
            console.log('Service Worker registered successfully:', registration.scope);
          })
          .catch(function(error) {
            console.log('Service Worker registration failed:', error);
          });
      });
    }
  </script>
</head>
<body class="sf-bg text-white font-inter min-h-screen">
  <!-- Mobile Top Bar -->
  <div class="lg:hidden fixed top-0 left-0 right-0 h-16 sf-topbar shadow-lg flex items-center justify-between px-6 z-30">
    <div class="flex items-center">
      <img src="/images/logo_mobile.svg" alt="StreamFlow Logo" class="h-8">
    </div>
    <div class="flex items-center gap-1">
      <div id="mobile-server-time" class="hidden items-center gap-1.5 text-gray-400 text-sm mr-2">
        <span id="mobile-server-date">--</span>
        <span class="text-purple-400/50">‚Ä¢</span>
        <span id="mobile-server-clock" class="tabular-nums">--:--:--</span>
      </div>
      <div id="mobile-separator" class="hidden h-4 w-px bg-purple-500/30 mr-1"></div>
      <a href="https://donate.youtube101.id/" target="_blank" 
         class="p-2 text-gray-400 hover:text-purple-300 transition-colors">
        <i class="ti ti-gift text-lg"></i>
      </a>
      <div class="relative">
        <button id="mobile-notification-btn" class="p-2 text-gray-400 hover:text-purple-300 transition-colors relative">
          <i class="ti ti-bell text-lg"></i>
          <span class="hidden absolute top-0.5 right-0.5 w-2 h-2 bg-purple-500 rounded-full"></span>
        </button>
      </div>
    </div>
  </div>
  <div class="flex relative z-10">
    <!-- Desktop Sidebar -->
    <div class="hidden lg:flex lg:fixed lg:flex-col w-20 h-screen pt-2 sf-sidebar shadow-lg overflow-hidden">
      <div class="flex items-center justify-center h-14 w-14 mx-auto mb-4">
        <img src="/images/logo.svg" alt="StreamFlow Logo" class="w-9 h-9">
      </div>
      <div class="flex-1">
        <a href="/dashboard" class="sidebar-icon group <%= active === 'dashboard' ? 'sf-nav-active' : '' %>">
          <i class="ti ti-broadcast text-xl"></i>
          <span class="text-xs mt-1">Streams</span>
          <span class="sidebar-tooltip group-hover:scale-100">Stream Manager</span>
        </a>
        <a href="/rotations" class="sidebar-icon group <%= active === 'rotations' ? 'sf-nav-active' : '' %>">
          <i class="ti ti-rotate text-xl"></i>
          <span class="text-xs mt-1">Rotations</span>
          <span class="sidebar-tooltip group-hover:scale-100">Stream Rotations</span>
        </a>
        <a href="/gallery" class="sidebar-icon group <%= active === 'gallery' ? 'sf-nav-active' : '' %>">
          <i class="ti ti-video text-xl"></i>
          <span class="text-xs mt-1">Gallery</span>
          <span class="sidebar-tooltip group-hover:scale-100">Video Gallery</span>
        </a>
        <a href="/playlist" class="sidebar-icon group <%= active === 'playlist' ? 'sf-nav-active' : '' %>">
          <i class="ti ti-playlist text-xl"></i>
          <span class="text-xs mt-1">Playlist</span>
          <span class="sidebar-tooltip group-hover:scale-100">Playlist Manager</span>
        </a>
        <a href="/history" class="sidebar-icon group <%= active === 'history' ? 'sf-nav-active' : '' %>">
          <i class="ti ti-history text-xl"></i>
          <span class="text-xs mt-1">History</span>
          <span class="sidebar-tooltip group-hover:scale-100">Stream History</span>
        </a>
        <% if (req.session && req.session.user_role === 'admin') { %>
        <a href="/users" class="sidebar-icon group <%= active === 'users' ? 'sf-nav-active' : '' %>">
          <i class="ti ti-users text-xl"></i>
          <span class="text-xs mt-1">Users</span>
          <span class="sidebar-tooltip group-hover:scale-100">User Management</span>
        </a>
        <% } %>
      </div>
      <div class="mt-auto">
        <div class="h-px bg-purple-500/20 w-full"></div>
        <div class="relative" id="profile-menu-container">
          <div class="h-20 flex items-center justify-center px-3 py-4 hover:bg-purple-500/10 transition-colors">
            <button id="profile-menu-button"
              class="w-12 h-12 rounded-full flex items-center justify-center overflow-hidden ring-2 ring-purple-500/30 hover:ring-purple-500 transition-all">
              <%- helpers.getAvatar(req) %>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Profile Dropdown -->
    <div id="profile-dropdown" class="sf-dropdown hidden">
      <div class="px-4 py-2 border-b border-purple-500/20">
        <div class="font-medium text-white"><%= helpers.getUsername(req) %></div>
      </div>
      <a href="/settings" class="sf-dropdown-item flex items-center text-sm">
        <i class="ti ti-settings mr-3 text-purple-400"></i>
        <span>Settings</span>
      </a>
      <a href="https://github.com/mpratama/streamflow/issues" target="_blank"
        class="sf-dropdown-item flex items-center text-sm">
        <i class="ti ti-help mr-3 text-purple-400"></i>
        <span>Help & Support</span>
      </a>
      <div class="h-px bg-purple-500/20 mx-4"></div>
      <a href="/logout" class="sf-dropdown-item flex items-center text-sm text-red-400 hover:text-red-300">
        <i class="ti ti-logout mr-3"></i>
        <span>Sign Out</span>
      </a>
    </div>
    <div class="w-full lg:ml-20 flex flex-col min-h-screen">
      <!-- Desktop Top Bar -->
      <div class="hidden lg:fixed lg:flex top-0 right-0 left-20 items-center justify-end h-14 px-6 sf-topbar shadow-md z-10">
        <div id="server-time-display" class="flex items-center gap-1.5 text-gray-400 text-sm mr-4">
          <span id="server-date">--</span>
          <span class="text-purple-400/50">‚Ä¢</span>
          <span id="server-clock" class="tabular-nums">--:--:--</span>
        </div>
        <div class="h-4 w-px bg-purple-500/30 mr-4"></div>
        <a href="https://github.com/mpratama/streamflow" target="_blank"
          class="p-2 text-gray-400 hover:text-purple-300 transition-colors mr-2">
          <i class="ti ti-brand-github text-lg"></i>
        </a>
        <div class="relative">
          <button id="notification-btn" class="p-2 text-gray-400 hover:text-purple-300 transition-colors relative">
            <i class="ti ti-bell text-lg"></i>
            <span class="hidden absolute top-0.5 right-0.5 w-2 h-2 bg-purple-500 rounded-full"></span>
          </button>
          <div id="notification-dropdown" class="hidden absolute right-0 mt-1 w-80 sf-dropdown z-[60]">
            <div class="p-3 border-b border-purple-500/20 flex items-center justify-between">
              <h3 class="font-medium text-white">Notifications</h3>
            </div>
            <div class="max-h-80 overflow-y-auto sf-scrollbar" id="notification-list">
            </div>
          </div>
        </div>
      </div>
      <div class="p-6 pt-20 lg:pt-22 flex-1">
        <%- body %>
      </div>
      <!-- Desktop Footer -->
      <div class="hidden lg:flex justify-end pr-6 py-4">
        <div class="flex items-center gap-2">
          <div class="text-xs text-gray-500">
            StreamFlow <span class="text-xs font-medium bg-purple-500/20 text-purple-300 px-1.5 py-0.5 rounded">v<%= appVersion %></span>
          </div>
          <div class="h-3 w-px bg-purple-500/30"></div>
          <a href="https://youtube.com/@mpratama" target="_blank" class="text-xs text-gray-500 hover:text-purple-300 hover:underline transition-colors">by Mpratama</a>
          <a href="https://saweria.co/fitrieffendi" target="_blank" class="saweria-button relative ml-1">
            <span class="relative z-10 flex items-center gap-1.5 text-gray-800 font-medium px-2.5 py-1 text-xs">
              <img src="/images/saweria.svg" alt="Saweria" class="w-3.5 h-3.5">
              <span>Donate</span>
            </span>
            <div class="saweria-tooltip px-3 py-2 bg-white text-gray-800 text-xs rounded-lg shadow-lg whitespace-nowrap">
              Terima kasih sudah bantu support üôè
              <div class="tooltip-arrow"></div>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>
  <!-- Mobile Bottom Navigation -->
  <div class="lg:hidden fixed bottom-0 left-0 right-0 sf-bottomnav shadow-lg z-30">
    <nav class="flex justify-around items-center h-16">
      <a href="/dashboard" class="bottom-nav-item <%= active === 'dashboard' ? 'sf-bottom-nav-active' : '' %>">
        <i class="ti ti-broadcast"></i>
        <span>Streams</span>
      </a>
      <a href="/rotations" class="bottom-nav-item <%= active === 'rotations' ? 'sf-bottom-nav-active' : '' %>">
        <i class="ti ti-rotate"></i>
        <span>Rotations</span>
      </a>
      <a href="/gallery" class="bottom-nav-item <%= active === 'gallery' ? 'sf-bottom-nav-active' : '' %>">
        <i class="ti ti-video"></i>
        <span>Gallery</span>
      </a>
      <a href="/playlist" class="bottom-nav-item <%= active === 'playlist' ? 'sf-bottom-nav-active' : '' %>">
        <i class="ti ti-playlist"></i>
        <span>Playlist</span>
      </a>
      <button id="mobile-profile-btn" class="bottom-nav-item">
        <div class="relative">
          <div class="w-6 h-6 rounded-full overflow-hidden mx-auto">
            <%- helpers.getAvatar(req) %>
          </div>
        </div>
        <span>Profile</span>
      </button>
    </nav>
    <!-- Mobile Profile Popup -->
    <div id="mobile-profile-popup" class="fixed bottom-16 right-2 sf-dropdown overflow-hidden hidden transform transition-all duration-200 ease-out opacity-0 translate-y-4 w-40">
      <div class="py-2 px-3">
        <div class="text-sm font-medium mb-1 text-white"><%= helpers.getUsername(req) %></div>
        <div class="text-xs text-gray-400 mb-2"><%= req.session.email || '' %></div>
        <div class="h-px bg-purple-500/20 my-2"></div>
        <% if (req.session && req.session.user_role === 'admin') { %>
        <a href="/users" class="flex items-center py-2 text-gray-300 hover:text-purple-300 text-sm transition-colors">
          <i class="ti ti-users mr-2"></i>
          <span>Users</span>
        </a>
        <% } %>
        <a href="/settings" class="flex items-center py-2 text-gray-300 hover:text-purple-300 text-sm transition-colors">
          <i class="ti ti-settings mr-2"></i>
          <span>Settings</span>
        </a>
        <div class="h-px bg-purple-500/20 my-2"></div>
        <a href="/logout" class="flex items-center py-2 text-red-400 hover:text-red-300 text-sm transition-colors">
          <i class="ti ti-logout mr-2"></i>
          <span>Sign Out</span>
        </a>
      </div>
    </div>
  </div>
  <!-- Mobile Notification Popup -->
  <div id="mobile-notification-popup" class="fixed bottom-16 right-2 sf-dropdown overflow-hidden hidden transform transition-all duration-200 ease-out opacity-0 translate-y-4 w-72 z-[60]">
    <div class="p-3 border-b border-purple-500/20 flex items-center justify-between">
      <h3 class="font-medium text-white">Notifications</h3>
    </div>
    <div class="max-h-80 overflow-y-auto sf-scrollbar" id="mobile-notification-list">
    </div>
  </div>
  <!-- Update Modal -->
  <div id="streamflowUpdateModal" class="fixed inset-0 sf-modal-overlay z-[60] hidden items-center justify-center p-4 overflow-y-auto">
    <div class="sf-modal w-full max-w-2xl m-auto flex flex-col max-h-[90vh]">
      <div class="flex-shrink-0 flex items-center justify-between px-5 py-3 border-b border-purple-500/20">
        <h3 class="text-lg font-medium text-white flex items-center gap-2">
          <span class="text-base">üéâ Update StreamFlow v2</span>
        </h3>
        <button onclick="closeStreamflowUpdateModal()" class="text-gray-400 hover:text-white hover:bg-purple-500/20 px-2 py-1 rounded-lg transition-colors">
          <i class="ti ti-x text-lg"></i>
        </button>
      </div>
      <div class="p-5 overflow-y-auto sf-scrollbar text-gray-300 space-y-4">
        <p class="text-sm">Terima kasih buat teman-teman yang sudah menunggu. Berikut adalah update terbaru yang ada di StreamFlow v2:</p>
        <div class="space-y-4">
          <div class="flex items-start gap-3">
            <div class="shrink-0">
              <div class="w-8 h-8 bg-purple-500/20 rounded-full flex items-center justify-center">
                <i class="ti ti-layout-dashboard text-purple-400"></i>
              </div>
            </div>
            <div>
              <h4 class="font-medium text-white text-sm">UI Baru yang Lebih Fresh</h4>
              <p class="text-gray-300 mt-1 text-sm">Tampilan baru yang lebih fresh dan user freindly. Sudah dibikin senyaman mungkin untuk kebutuhan live streaming.</p>
            </div>
          </div>
          <div class="flex items-start gap-3">
            <div class="shrink-0">
              <div class="w-8 h-8 bg-green-500/20 rounded-full flex items-center justify-center">
                <i class="ti ti-rocket text-green-400"></i>
              </div>
            </div>
            <div>
              <h4 class="font-medium text-white text-sm">Live Streaming Lebih Ringan</h4>
              <p class="text-gray-300 mt-1 text-sm">Di StreamFlow v2, proses streaming sudah dioptimalkan, sehingga jauh lebih ringan dibandingkan StreamFlow v1 sebelumnya.</p>
            </div>
          </div>
          <div class="flex items-start gap-3">
            <div class="shrink-0">
              <div class="w-8 h-8 bg-purple-500/20 rounded-full flex items-center justify-center">
                <i class="ti ti-calendar text-purple-400"></i>
              </div>
            </div>
            <div>
              <h4 class="font-medium text-white text-sm">Penjadwalan Live Streaming</h4>
              <p class="text-gray-300 mt-1 text-sm">Di versi baru ini, fitur penjadwalan streaming ataupun auto stop sudah ditambahkan dan diperbaiki dibanding versi sebelumnya.</p>
            </div>
          </div>
          <div class="flex items-start gap-3">
            <div class="shrink-0">
              <div class="w-8 h-8 bg-amber-500/20 rounded-full flex items-center justify-center">
                <i class="ti ti-bug text-amber-400"></i>
              </div>
            </div>
            <div>
              <h4 class="font-medium text-white text-sm">Fix Bug</h4>
              <p class="text-gray-300 mt-1 text-sm">Beberapa bug yang sering ditemui di versi sebelumnya sudah di fix pada StreamFlow v2 ini, salah satunya bug streaming tiba-tiba terhenti.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
